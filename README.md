# vk_face_collector
**Face Task Queue Microservice**

Микросервис для управления задачами распознавания лиц. Принимает задачи от бота, ставит их в очередь с поддержкой приоритетов и передает их на обработку микросервису распознавания лиц.

---

## 🔹 Основные функции

### 1. Приём задач от бота
Каждая задача содержит:
- `job_id` — уникальный идентификатор задачи
- `user_id` — идентификатор пользователя
- `photo_id` — ID файла на Google Drive
- `metadata` — дополнительные данные
- `priority` — приоритет задачи (чем выше — тем раньше выполняется)

### 2. Очередь задач с приоритетами
- Используется **Redis Sorted Set** для хранения задач
- Задачи с наибольшим приоритетом выполняются первыми
- Методы:
  - `enqueue_task(task: dict)` — добавить задачу в очередь
  - `dequeue_task() -> dict | None` — получить следующую задачу

### 3. Логирование
- Все действия логируются через **синглтон Logger**
- Логи сохраняются в файл и выводятся в консоль

---

## 🔹 Технологии

- **Python 3.10+**
- **FastAPI** — для приёма задач через REST API
- **Redis** — для очереди задач с поддержкой приоритетов
- **Pydantic** — для валидации и сериализации данных
- **Google Drive API** — для хранения изображений (файлы передаются ботом)
- **logging** — с синглтоном Logger

---

## 🔹 Пример структуры проекта

vk_face_collector/
├── app/ # Основной код микросервиса
│ ├── main.py # FastAPI эндпоинты
│ ├── models.py # Pydantic модели: TaskRequest, TaskResponse
│ ├── statuses.py # Enum статусов задач и файлов
│ ├── task_queue.py # Работа с Redis очередью задач
│ ├── gdrive_manager.py # Работа с Google Drive (бот загружает файлы)
│ ├── fileManager.py # Утилиты для работы с файлами
│ └── logger.py # Синглтон Logger для логирования
├── tests/ # Тесты микросервиса
│ ├── test_main.py
│ └── test_task_queue.py
├── requirements.txt # Зависимости проекта
├── config.py # Конфигурации (Redis URL, пути, токены)
├── errors.py # Централизованные коды ошибок
└── README.md # Документация проекта